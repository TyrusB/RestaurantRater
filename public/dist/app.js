function Restaurant(a){$.extend(this,a)}function handleActivationStatusOfSubmit(){var a=$("#rest-submit"),b=$("#rest-input").val();b&&a.attr("disabled")?a.removeAttr("disabled"):b||a.attr("disabled","disabled")}function Restaurants(a){this.models=[];var b=this;_.each(a,function(a){var c=new Restaurant(a);b.models.push(c)})}Restaurant.prototype.buildLi=function(){var a='<li data-id="'+this._id+'"';return this.ratings&&this.ratings.overall.avgScore&&(a+='data-avg-overall="'+this.ratings.overall.avgScore+'"'),a+=">"+this.name+"</li>",$(a)},Restaurant.prototype.submitRating=function(a,b){$.ajax({url:"/restaurants/"+this._id+"/ratings",method:"post",data:{overallRating:a},success:function(a){b.find($("#avg-score")).text(a.ratings.overall.avgScore),b.find($("#num-ratings")).text(a.ratings.overall.numRatings),$(".past-ratings-info").find("span").text("You've rated this restaurant. Feel free to change your rating.")}})},$(function(){if($("#restaurants-data").length>0){var a=JSON.parse($("#restaurants-data").html()),b=new Restaurants(a),c=b.buildList();c.appendTo($("#restaurants-list")),$("input[name=restaurant_name]").on("keyup",function(){var a=$("#rest-input").val(),c=b.searchNames(a),d=b.buildList(c);$("#restaurants-list").empty().append(d),b.exactNameMatch(a)?$(".restaurant-form").find("input[type=submit]").attr("value","Go").css("background-color","#32CD32"):$(".restaurant-form").find("input[type=submit]").attr("value","Add").css("background-color","red"),handleActivationStatusOfSubmit()}),$("#restaurants-list").on("click","li",function(){{var a=$(this).text();$(this).data("id")}$(".restaurant-form").find("input[name=restaurant_name]").val(a),$(".restaurant-form").find("input[type=submit]").attr("value","Go").css("background-color","#32CD32"),handleActivationStatusOfSubmit()}),$(".restaurant-form").on("submit",function(){var a=$(this).find("#rest-input").val();if(b.exactNameMatch(a)){var c=b.findRestaurant(a);$(this).attr("action","/restaurants/"+c._id).attr("method","get")}else $(this).attr("action","/restaurants/new").attr("method","post");return!0})}}),$(function(){if($("#restaurant-data").length>0){var a=JSON.parse($("#restaurant-data").html()),b=new Restaurant(a),c=$("#slider-val").data("slider-val");$(".slider").slider({step:10,value:c||50,change:function(a,b){var c=b.value/20;$(".current-rating-num").text(c),2>c?$(".current-rating-num").css("color","red"):c>=3.5?$(".current-rating-num").css("color","green"):$(".current-rating-num").css("color","gold")}}),$(".slider").slider({value:c}),$("#submit-ratings").on("click",function(a){a.preventDefault();var c=$(".slider").slider("value")/20;b.submitRating(c,$(".ratings-info-section"))})}}),Restaurants.prototype.buildList=function(a){"undefined"==typeof a&&(a=this.models);var b=$('<ul id="restaurants-holder"></ul>');return _.each(a,function(a){var c=a.buildLi();b.append(c)}),b},Restaurants.prototype.searchNames=function(a){var b=[];return _.each(this.models,function(c){-1!==c.name.toLowerCase().indexOf(a.toLowerCase())&&b.push(c)}),b},Restaurants.prototype.exactNameMatch=function(a){return _.any(this.models,function(b){return b.name.toLowerCase()===a.toLowerCase()})},Restaurants.prototype.findRestaurant=function(a){return _.find(this.models,function(b){return b.name.toLowerCase()===a.toLowerCase()?b:void 0})},$(function(){$('input[type="text"]').on("focus blur",function(){$(this).toggleClass("form-focused")})});