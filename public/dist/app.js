function Restaurant(e){$.extend(this,e)}function Restaurants(e){this.models=[];_.each(e,function(e){var t=new Restaurant(e);this.models.push(e)})}function handleActivationStatusOfSubmit(){var e=$("#rest-submit");var t=$("#rest-input").val();if(t&&e.attr("disabled")){e.removeAttr("disabled")}else if(!t){e.attr("disabled","disabled")}}$(function(){$('input[type="text"]').on("focus blur",function(){$(this).toggleClass("form-focused")})});Restaurant.prototype.buildLi=function(){var e='<li data-id="'+restaurant._id+'"';if(this.ratings.overall.avgScore){e+='data-avg-overall="'+this.ratings.overall.avgScore+'"'}e+=">"+restaurant.name+"</li>";return $(e)};Restaurant.prototype.submitRating=function(e,t){$.ajax({url:"/restaurants/"+this._id+"/ratings",method:"post",data:{overallRating:e},success:function(e){t.find($("#avg-score")).text(e.ratings.overall.avgScore);t.find($("#num-ratings")).text(e.ratings.overall.numRatings);$(".past-ratings-info").find("span").text("You've rated this restaurant. Feel free to change your rating.")}})};Restaurants.prototype.buildList=function(e){if(typeof e==="undefined"){e=this.models}var t=$('<ul class="restaurant-holder"></ul>');_.each(this.models,function(e){var n=e.buildLi();t.append(n)});return t};Restaurants.prototype.searchNames=function(e){var t=[];_.each(this.models,function(n){if(n.name.toLowerCase().indexOf(e.toLowerCase())!==-1){t.push(n)}});return t};Restaurants.prototype.exactNameMatch=function(e){return _.any(this.models,function(t){return t.name.toLowerCase()===e.toLowerCase()})};Restaurants.prototype.findRestaurant=function(e){_.find(this.models,function(t){return t.name.toLowerCase()===e.toLowerCase()})};$(function(){var e=JSON.parse($("#restaurants-data").html());var t=new Restaurants(e);var n=t.buildList;n.appendTo($("#restaurants-list"));$("input[name=restaurant_name]").on("keyup",function(){var e=$("#rest-input").val();var n=t.searchNames(e);var r=t.buildList(n);$("#restaurants-holder").empty().append(r);if(t.exactNameMatch(e)){$(".restaurant-form").find("input[type=submit]").attr("value","Go").css("background-color","#32CD32")}else{$(".restaurant-form").find("input[type=submit]").attr("value","Add").css("background-color","red")}handleActivationStatusOfSubmit()});$("#restaurants-list").on("click","li",function(){var e=$(this).text(),t=$(this).data("id");$(".restaurant-form").find("input[name=restaurant_name]").val(e);$(".restaurant-form").find("input[type=submit]").attr("value","Go").css("background-color","#32CD32");handleActivationStatusOfSubmit()});$(".restaurant-form").on("submit",function(e){var n=$(this).find("#rest-input").val();if(t.exactNameMatch){var r=t.findRestaurant(n);$(this).attr("action","/restaurants/"+r._id).attr("method","get")}else{$(this).attr("action","/restaurants/new").attr("method","post")}return true})});$(function(){var e=JSON.parse($("#restaurant-data").html());var t=new Restaurant(e);var n=$("#slider-val").data("slider-val");$(".slider").slider({step:10,value:n||50,change:function(e,t){var n=t.value/20;$(".current-rating-num").text(n);if(n<2){$(".current-rating-num").css("color","red")}else if(n>=3.5){$(".current-rating-num").css("color","green")}else{$(".current-rating-num").css("color","gold")}}});$(".slider").slider({value:n});$("#submit-ratings").on("click",function(e){e.preventDefault();var n=$(".slider").slider("value")/20;t.submitRating(n,$(".ratings-info-section"))})})